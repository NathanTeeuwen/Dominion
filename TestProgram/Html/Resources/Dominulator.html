<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<title>Dominulator</title>
<head>
<script type="text/javascript" src="https://www.google.com/jsapi"></script>
<script type="text/javascript">
  google.load("visualization", "1", {packages:["corechart"]});
</script>
  
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src='http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js'></script>
<link href='http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/themes/cupertino/jquery-ui.css' type='text/css' rel='Stylesheet' />
 
<script type="text/javascript">

function PlayGame() {

    var resultDiv = $("#resultDivContainer");    
    var player1Strat = $("#player1Strategy :selected").text();
    var player2Strat = $("#player2Strategy :selected").text();    
    $.ajax({
        url: "http://localhost:8081/dominion/StrategyComparisonRequest",
        type: "POST",
        data: JSON.stringify({ player1:player1Strat, player2:player2Strat}),
        dataType: "html",        
        success: function (result) {        
            resultDiv.contents().find('html').html(result);                    
        }
    });
};
</script>
  
<script type="text/javascript">

var nextId = 0;

function CreateAndAppendGraphDiv()
{
  nextId += 1;
  var chartId = "chart_div" + nextId;    
  var newDiv = document.createElement('div');
  newDiv.setAttribute('id', chartId);
  newDiv.setAttribute('style', 'width: 900px; height: 500px');  
  $("#chartsInsertionPoint").prepend(newDiv);
  return newDiv;
}

function InsertGraph() {
    
    var player1Strat = $("#player1Strategy :selected").text();
    var player2Strat = $("#player2Strategy :selected").text();
    var graphName = $("#selectedGraph :selected").text();
    
    var resultDiv = $("#resultDivContainer");    
    $.ajax({
        url: "http://localhost:8081/dominion/" + graphName,
        type: "POST",
        data: JSON.stringify({ player1:player1Strat, player2:player2Strat}),
        dataType: "json",        
        success: function (json) {       
          
          var chartDiv = CreateAndAppendGraphDiv();
          var data = google.visualization.arrayToDataTable(json.data);          
          
          var chart;
          if (json.type == "pie")
          {
            chart = new google.visualization.PieChart(chartDiv);   
          }
          else if (json.type == "line")    
          {
            chart = new google.visualization.LineChart(chartDiv);   
          }
          
          chart.draw(data, json.options);
        }      
    });
};
</script>

<script type="text/javascript">

function GetAvailableStrategies(id) {

    $.ajax({
        url:'http://localhost:8081/dominion/GetAvailableStrategies',
        type:'POST',
        data: '',
        dataType: 'json',
        success: function( json ) {          
            $(id).empty();
            $.each(json, function(i, value) {
                $(id).append($('<option>').text(value).attr('value', value));
            });
        },       
    });      
};

function GetAvailableGraphs(id) {

    var player1Strat = $("#player1Strategy :selected").text();
    var player2Strat = $("#player2Strategy :selected").text();

    $.ajax({
        url:'http://localhost:8081/dominion/GetAvailableGraphs',
        type:'POST',
        data: JSON.stringify({ player1:player1Strat, player2:player2Strat}),
        dataType: 'json',
        success: function( json ) {          
            $(id).empty();
            $.each(json, function(i, value) {
                $(id).append($('<option>').text(value).attr('value', value));
            });
        },       
    });      
};

</script>

<!-- Style the combo boxees to be auto complete typeable boxes -->
	<style>
        .custom-combobox {
            position: relative;
            display: inline-block;
        }
        .custom-combobox-toggle {
            position: absolute;
            top: 0;
            bottom: 0;
            margin-left: -1px;
            padding: 0;
            /* support: IE7 */
            *height: 1.7em;
            *top: 0.1em;
        }
        .custom-combobox-input {
            margin: 0;
            padding: 0.3em;
        }
	</style>
<!-- Script for combo boxes -->
	<script>
	(function( $ ) {
		$.widget( "custom.combobox", {
			_create: function() {
				this.wrapper = $( "<span>" )
					.addClass( "custom-combobox" )
					.insertAfter( this.element );

				this.element.hide();
				this._createAutocomplete();
				this._createShowAllButton();
			},

			_createAutocomplete: function() {
				var selected = this.element.children( ":selected" ),
					value = selected.val() ? selected.text() : "";

				this.input = $( "<input>" )
					.appendTo( this.wrapper )
					.val( value )
					.attr( "title", "" )
					.addClass( "custom-combobox-input ui-widget ui-widget-content ui-state-default ui-corner-left" )
					.autocomplete({
						delay: 0,
						minLength: 0,
						source: $.proxy( this, "_source" )
					})
					.tooltip({
						tooltipClass: "ui-state-highlight"
					});

				this._on( this.input, {
					autocompleteselect: function( event, ui ) {
						ui.item.option.selected = true;
						this._trigger( "select", event, {
							item: ui.item.option
						});
					},

					autocompletechange: "_removeIfInvalid"
				});
			},

			_createShowAllButton: function() {
				var input = this.input,
					wasOpen = false;

				$( "<a>" )
					.attr( "tabIndex", -1 )
					.attr( "title", "Show All Items" )
					.tooltip()
					.appendTo( this.wrapper )
					.button({
						icons: {
							primary: "ui-icon-triangle-1-s"
						},
						text: false
					})
					.removeClass( "ui-corner-all" )
					.addClass( "custom-combobox-toggle ui-corner-right" )
					.mousedown(function() {
						wasOpen = input.autocomplete( "widget" ).is( ":visible" );
					})
					.click(function() {
						input.focus();

						// Close if already visible
						if ( wasOpen ) {
							return;
						}

						// Pass empty string as value to search for, displaying all results
						input.autocomplete( "search", "" );
					});
			},

			_source: function( request, response ) {
				var matcher = new RegExp( $.ui.autocomplete.escapeRegex(request.term), "i" );
				response( this.element.children( "option" ).map(function() {
					var text = $( this ).text();
					if ( this.value && ( !request.term || matcher.test(text) ) )
						return {
							label: text,
							value: text,
							option: this
						};
				}) );
			},

			_removeIfInvalid: function( event, ui ) {

				// Selected an item, nothing to do
				if ( ui.item ) {
					return;
				}

				// Search for a match (case-insensitive)
				var value = this.input.val(),
					valueLowerCase = value.toLowerCase(),
					valid = false;
				this.element.children( "option" ).each(function() {
					if ( $( this ).text().toLowerCase() === valueLowerCase ) {
						this.selected = valid = true;
						return false;
					}
				});

				// Found a match, nothing to do
				if ( valid ) {
					return;
				}

				// Remove invalid value
				this.input
					.val( "" )
					.attr( "title", value + " didn't match any item" )
					.tooltip( "open" );
				this.element.val( "" );
				this._delay(function() {
					this.input.tooltip( "close" ).attr( "title", "" );
				}, 2500 );
				this.input.data( "ui-autocomplete" ).term = "";
			},

			_destroy: function() {
				this.wrapper.remove();
				this.element.show();
			}
		});
	})( jQuery );	
	</script>
</head>
<body>

<h1>Dominulator</h1>

<br>
<div>
  <label>Player1: </label>
  <select id='player1Strategy'></select>
  <script type="text/javascript" onChange ='ResetGraphArea()'>    
      $("#player1Strategy").combobox();    
      GetAvailableStrategies("#player1Strategy");    
  </script>
  <br>
</div>
  
<div>
  <label>Player2:</label>
  <select id='player2Strategy'></select>
  <script type="text/javascript">    
      $("#player2Strategy").combobox();    
      GetAvailableStrategies("#player2Strategy");    
  </script>
  <br>
</div>
  
<button type="button" onclick="ResetGraphArea(); ShowGraphArea()">Play ...</button>

<div id="GraphArea" style="display: none;">
  <script type="text/javascript">            
  function ShowGraphArea()
  {
    document.getElementById('GraphArea').style.display = "inline";
    GetAvailableGraphs("#selectedGraph");    
  }
  
  function ResetGraphArea()
  {
    document.getElementById('GraphArea').style.display = "none";
    $("#chartsInsertionPoint").empty();
  }
  </script>
    
  <div>
    <label>Graph</label>
    <select id='selectedGraph'></select>
    <script type="text/javascript">    
        $("#selectedGraph").combobox();       
    </script>
    <br>
  </div>

  
  <br>
  <button type="button" onclick="InsertGraph()">Insert Graph</button>
  
  <div id="chartsInsertionPoint"></div>
</div>

</body>
</html> 